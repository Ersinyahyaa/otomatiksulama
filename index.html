<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Firebase Relay Control Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0 10px 40px;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      justify-content: space-between;
    }
    h1 {
      margin-top: 30px;
      font-size: 1.8rem;
    }
    .relay-card {
      display: inline-block;
      padding: 20px;
      margin: 15px;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      width: 220px;
      vertical-align: top;
      color: white;
    }
    .relay-card h2 {
      margin-bottom: 10px;
      font-size: 1.3rem;
    }
    .relay-card p {
      margin-bottom: 10px;
      font-size: 1rem;
    }
    .relay-card button {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      color: white;
      background-color: #1e88e5;
      cursor: pointer;
      font-size: 16px;
      width: 90%;
    }
    #dashboard .relay-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .log-table {
      margin: 20px auto;
      width: 90%;
      max-width: 960px;
      border-collapse: collapse;
    }
    .log-table th, .log-table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    .log-table th {
      background-color: #f0f0f0;
    }
    #loginForm {
      max-width: 400px;
      margin: 80px auto 20px;
      background: white;
      padding: 30px 20px;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    #loginForm input, #loginForm button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      font-size: 1rem;
    }
    #loginForm button {
      background-color: #1e88e5;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1>Firebase Relay Control Dashboard</h1>

<div id="loginForm">
  <input type="email" id="email" placeholder="Enter Email" />
  <input type="password" id="password" placeholder="Enter Password" />
  <button onclick="login()">Login</button>
</div>

<div id="dashboard" style="display:none;">
  <div class="relay-container">
    <div class="relay-card" id="vana1Card">
      <h2>Vana 1</h2>
      <p>Status: <span id="vana1Status"></span></p>
      <button onclick="toggleRelay('vana1Durum')">Toggle</button>
    </div>
    <div class="relay-card" id="vana2Card">
      <h2>Vana 2</h2>
      <p>Status: <span id="vana2Status"></span></p>
      <button onclick="toggleRelay('vana2Durum')">Toggle</button>
    </div>
    <div class="relay-card" id="hidroforCard">
      <h2>Hidrofor</h2>
      <p>Status: <span id="hidroforStatus"></span></p>
      <button onclick="toggleRelay('hidroforDurum')">Toggle</button>
    </div>
  </div>
  <div style="margin-top:20px">
    <p>Su Litresi: <span id="suLitresi"></span> L</p>
    <p>Toprak Nem: <span id="toprakNem"></span>%</p>
    <p>Su Yüzdesi: <span id="suYuzdesi"></span>%</p>
  </div>
  <h2>Loglar</h2>
  <table class="log-table" id="logTable">
    <thead>
      <tr><th>Tarih</th><th>Su Alarm</th><th>Su Litresi</th><th>Su Yüzdesi</th><th>Toprak Nem</th></tr>
    </thead>
    <tbody id="logBody"></tbody>
  </table>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyApy-6P6wctARMhBZMeea6AE0KxvjklLsQ",
    authDomain: "esp32-b35c8.firebaseapp.com",
    databaseURL: "https://esp32-b35c8-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "esp32-b35c8",
    storageBucket: "esp32-b35c8.appspot.com",
    messagingSenderId: "47343608336",
    appId: "1:47343608336:web:2896e196cdf3f2b8616095"
  };

  firebase.initializeApp(firebaseConfig);

  function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    firebase.auth().signInWithEmailAndPassword(email, password)
      .then(() => {
        document.getElementById("loginForm").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
        setupDashboard();
      })
      .catch(err => alert(err.message));
  }

  function setupDashboard() {
    const db = firebase.database();
    const relays = [
      { key: 'vana1Durum', statusId: 'vana1Status', cardId: 'vana1Card' },
      { key: 'vana2Durum', statusId: 'vana2Status', cardId: 'vana2Card' },
      { key: 'hidroforDurum', statusId: 'hidroforStatus', cardId: 'hidroforCard' },
    ];

    relays.forEach(relay => {
      const ref = db.ref(relay.key);
      ref.on('value', snap => {
        const val = snap.val();
        document.getElementById(relay.statusId).innerText = val ? "ON" : "OFF";
        document.getElementById(relay.cardId).style.backgroundColor = val ? "green" : "red";
      });
    });

    db.ref("suLitresi").on('value', s => {
      document.getElementById("suLitresi").innerText = s.val();
    });
    db.ref("toprakNem").on('value', s => {
      document.getElementById("toprakNem").innerText = s.val();
    });
    db.ref("suYuzdesi").on('value', s => {
      document.getElementById("suYuzdesi").innerText = s.val();
    });

    db.ref("loglar/2025-05-31").on('value', snap => {
      const data = snap.val();
      if (!data) return;
      const body = document.getElementById("logBody");
      body.innerHTML = '';
      const row = `<tr>
        <td>2025-05-31</td>
        <td>${data.suAlarm}</td>
        <td>${data.suLitresi}</td>
        <td>${data.suYuzdesi}</td>
        <td>${data.toprakNem}</td>
      </tr>`;
      body.innerHTML += row;
    });
  }

  function toggleRelay(key) {
    const ref = firebase.database().ref(key);
    ref.once('value').then(snap => {
      ref.set(!snap.val());
    });
  }
</script>

</body>
</html>
